<head>
    <meta charset="utf-8"/>
    <script type="text/javascript" src="data.json" charset="utf-8"></script>
    <link href='https://fonts.googleapis.com/css?family=Fjalla+One&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
    <style>
    body {
        background: url(img/background.jpg), black;
        font-family: "Fjalla One", san-serif;
        color: white;
    }

    #main > * {
        margin-left: auto;
        margin-right: auto;
    }

    #word {
        font-size: 6vw;
        text-align: center;
    }

    #definition {
        font-size: 1.5vw;
        text-align: center;
    }

    #conjugation {
        margin-top: 1ex;
        font-size: 4vw;
        text-align: center;
    }

    .wordbox {
        font-size: 6vw;
        width: 20ex;
        outline: none;
    }

    #inputbox {
        border-radius: 20px;
        margin-top: 0.2ex;
        margin-bottom: 0.1ex;
        padding: 5px;
        padding-left: 20px;
        padding-right: 20px;
    }

    #answerbox {
        color: lightgray;
        font-style: italic;
        text-align: right;
        text-shadow: 0px 0px 10px rgba(0, 0, 0, 0.25);
    }

    @keyframes entered {
        0% {
            transform: scale(1.0);
        }

        100% {
            transform: scale(1.01);
        }
    }

    .phaseout {
        animation-name: entered;
        animation-duration: 0.1s;
        animation-direction: alternate;
        animation-timing-function: ease;
    }

    .noanswer {
        border: solid rgb(20, 61, 102) 5pt;
        background-color: rgb(51, 153, 255);
    }

    .incorrect {
        border: solid rgb(102, 30, 0) 5pt;
        background-color: rgb(255, 50, 50);
    }

    .correct {
        border: solid rgb(30, 102, 0) 5pt;
        background-color: rgb(71, 209, 71);
    }

    </style>
</head>

<body>
    <div id="main">
        <div id="word"></div>
        <div id="definition"></div>
        <div id="conjugation">none</div>
        <div id="inputbox" class="wordbox noanswer" contenteditable></div>
        <div id="answerbox" class="wordbox"></div>
    </div>

    <script>
    var __MOODS_AND_TENSES__ = [
        [0, "Present"],
        [1, "Future"],
        [2, "Imperfect"],
        [3, "Preterite"],
        [4, "Conditional"],
        [5, "Present Perfect"],
        [6, "Future Perfect"],
        [7, "Past Perfect"],
        // [8, "Preterite (Archaic)"],
        [9, "Conditional Perfect"],
        [10, "Present Subjunctive"],
        [11, "Imperfect Subjunctive"],
        [12, "Future Subjunctive"],
        [13, "Present Perfect Subjunctive"],
        [14, "Future Perfect Subjunctive"],
        [15, "Past Perfect Subjuntive"],
        [16, "Affirmative Imperative"],
        [17, "Negative Imperative"],
    ];

    var __PERSON_AND_NUMBER__ = [
        [0, "yo"],
        [1, "tú"],
        [2, "él/ella/usted"],
        [3, "nosotros"],
        [4, "vosotros"],
        [5, "ellos/ellas/ustedes" ],
    ];

    function generateRandomConjugationTest() {
        var keys = Object.keys(__WORDS__);
        var verb = keys[Math.floor(Math.random() * keys.length)];
        var verbArray = __WORDS__[verb];
        var moodAndTenseIndex = Math.floor(Math.random() * __MOODS_AND_TENSES__.length);
        var personAndNumberIndex = Math.floor(Math.random() * __PERSON_AND_NUMBER__.length);

        return {
            verb: verb,
            definition: verbArray[0],
            conjugatedVerb: verbArray[1 + (__MOODS_AND_TENSES__[moodAndTenseIndex][0] * 6) +
                                          __PERSON_AND_NUMBER__[personAndNumberIndex][0]],
            moodAndTenseText: __MOODS_AND_TENSES__[moodAndTenseIndex][1],
            personAndNumberText: __PERSON_AND_NUMBER__[personAndNumberIndex][1],
        }
    }

    function chooseNewConjugation() {
        var conjugationTest = generateRandomConjugationTest();
        while (conjugationTest.answer == '') {
            conjugationTest = generateRandomConjugationTest();
        }

        document.getElementById('word').innerText = conjugationTest.verb;
        document.getElementById('definition').innerText = "(" + conjugationTest.definition + ")";
        document.getElementById('conjugation').innerText =
            conjugationTest.moodAndTenseText + "  +  " + conjugationTest.personAndNumberText;
        window.__ANSWER__ = conjugationTest.conjugatedVerb;
        console.log(conjugationTest.conjugatedVerb);

        var inputBox = document.getElementById('inputbox');
        inputBox.innerText = "";
        inputBox.style.display = "";
        inputBox.className = "wordbox noanswer";
        inputBox.focus();

        var answerBox = document.getElementById('answerbox');
        answerBox.innerText = "";

        inTestingMode = true;
    }

    function checkConjugation() {
        var inputBox = document.getElementById('inputbox');
        var answerBox = document.getElementById('answerbox');

        if (inputBox.innerText == __ANSWER__)
            inputBox.className = "wordbox correct phaseout";
        else {
            inputBox.className = "wordbox incorrect phaseout";
            answerBox.innerText = __ANSWER__;
        }
        inputBox.blur();

        inTestingMode = false;
    }

    function getEvent(event) {
        if (!event)
            return window.event;
        return event;
    }

    function getEventTarget(event) {
        var event = getEvent(event);
        if (event.target)
            return event.target;
        else if (event.srcElement)
            return event.srcElement;
        return null;
    }

    function keyPress(event) {
        var event = getEvent(event);
        if (event.keyCode == 13) {
            event.preventDefault();
            event.stopPropagation();

            if (inTestingMode) {
                checkConjugation();
            } else {
                chooseNewConjugation();
            }
        }

        return false;
    }

    var inputBox = document.getElementById('inputbox');
    inputBox.addEventListener("keypress", keyPress, false);
    document.body.addEventListener("keypress", keyPress, false);

    chooseNewConjugation();
    </script>
</body>
