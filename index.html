<head>
    <meta charset="utf-8"/>
    <script type="text/javascript" src="data.json" charset="utf-8"></script>
    <link href='https://fonts.googleapis.com/css?family=Fjalla+One&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
    <style>
    body {
        background: url(img/background.jpg), black;
        font-family: "Fjalla One", san-serif;
        color: white;
    }

    #main > * {
        margin-left: auto;
        margin-right: auto;
    }

    #word {
        font-size: 6vw;
        text-align: center;
    }

    #conjugation {
        font-size: 2vw;
        text-align: center;
    }

    .wordbox {
        font-size: 6vw;
        width: 20ex;
        outline: none;
    }

    #inputbox {
        border-radius: 20px;
        margin-top: 1ex;
        margin-bottom: 0.5ex;
        padding: 5px;
        padding-left: 20px;
        padding-right: 20px;
    }

    #answerbox {
        font-style: italic;
        text-align: right;
        color: lightgray;
    }

    @keyframes entered {
        0% {
            transform: scale(1.0);
        }

        100% {
            transform: scale(1.01);
        }
    }

    .phaseout {
        animation-name: entered;
        animation-duration: 0.1s;
        animation-direction: alternate;
        animation-timing-function: ease;
    }

    .noanswer {
        border: solid rgb(20, 61, 102) 5pt;
        background-color: rgb(51, 153, 255);
    }

    .incorrect {
        border: solid rgb(102, 30, 0) 5pt;
        background-color: rgb(255, 50, 50);
    }

    .correct {
        border: solid rgb(30, 102, 0) 5pt;
        background-color: rgb(71, 209, 71);
    }

    </style>
</head>

<body>
    <div id="main">
        <div id="word"></div>
        <div id="conjugation">none</div>
        <div id="inputbox" class="wordbox noanswer" contenteditable></div>
        <div id="answerbox" class="wordbox"></div>
    </div>

    <script>
    function generateRandomConjugationTest() {
        var conjugations = [
            "Present",
            "Future",
            "Imperfect",
            "Preterite",
            "Conditional",
            "Present Perfect",
            "Future Perfect",
            "Past Perfect",
            "Preterite (Archaic)",
            "Conditional Perfect",
            "Present Subjunctive",
            "Imperfect Subjunctive",
            "Future Subjunctive",
            "Present Perfect Subjunctive",
            "Future Perfect Subjunctive",
            "Past Perfect Subjuntive",
            "Affirmative Imperative",
            "Negative Imperative",
        ]
        var tenses = [ "yo", "tú", "él/ella/Ud.", "nosotros", "vosotros", "ellos/ellas/Uds." ];
        var keys = Object.keys(__WORDS__);
        var verb = keys[Math.floor(Math.random() * keys.length)];
        var verbArray = __WORDS__[verb];
        var conjugationIndex = Math.floor(Math.random() * conjugations.length)
        var tenseIndex = Math.floor(Math.random() * tenses.length)

        return {
            verb: verb,
            conjugatedVerb: verbArray[(conjugationIndex * 6) + tenseIndex],
            conjugationText: conjugations[conjugationIndex],
            tenseText: tenses[tenseIndex],
        }
    }

    function chooseNewConjugation() {
        var conjugationTest = generateRandomConjugationTest();
        while (conjugationTest.answer == '') {
            conjugationTest = generateRandomConjugationTest();
        }

        document.getElementById('word').innerText = conjugationTest.verb;
        document.getElementById('conjugation').innerText =
            conjugationTest.conjugationText + "  +  " + conjugationTest.tenseText;
        window.__ANSWER__ = conjugationTest.conjugatedVerb;
        console.log(conjugationTest.conjugatedVerb);

        var inputBox = document.getElementById('inputbox');
        inputBox.innerText = "";
        inputBox.style.display = "";
        inputBox.className = "wordbox noanswer";
        inputBox.focus();

        var answerBox = document.getElementById('answerbox');
        answerBox.innerText = "";

        inTestingMode = true;
    }

    function checkConjugation() {
        var inputBox = document.getElementById('inputbox');
        var answerBox = document.getElementById('answerbox');

        if (inputBox.innerText == __ANSWER__)
            inputBox.className = "wordbox correct phaseout";
        else {
            inputBox.className = "wordbox incorrect phaseout";
            answerBox.innerText = __ANSWER__;
        }
        inputBox.blur();

        inTestingMode = false;
    }

    function getEvent(event) {
        if (!event)
            return window.event;
        return event;
    }

    function getEventTarget(event) {
        var event = getEvent(event);
        if (event.target)
            return event.target;
        else if (event.srcElement)
            return event.srcElement;
        return null;
    }

    function keyPress(event) {
        var event = getEvent(event);
        if (event.keyCode == 13) {
            event.preventDefault();
            event.stopPropagation();

            if (inTestingMode) {
                checkConjugation();
            } else {
                chooseNewConjugation();
            }
        }

        return false;
    }

    var inputBox = document.getElementById('inputbox');
    inputBox.addEventListener("keypress", keyPress, false);
    document.body.addEventListener("keypress", keyPress, false);

    chooseNewConjugation();
    </script>
</body>
